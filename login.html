<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Masuk - Tenangin</title>
  <link rel="stylesheet" href="css/app.css">
</head>
<body>
  <div class="container center-content">
    <h2>Selamat Datang</h2>
    <p style="margin-bottom: 30px;">Masuk untuk melanjutkan</p>

    <button id="google-login-btn" class="btn btn-secondary" style="background-color: #fff; color: #000; border: 1px solid #ddd;">
      <span style="margin-right: 8px;">G</span> Masuk dengan Google
    </button>

    <div style="display: flex; align-items: center; width: 100%; margin: 20px 0;">
      <div style="flex: 1; height: 1px; background-color: var(--divider-color);"></div>
      <span style="padding: 0 10px; color: var(--text-secondary); font-size: 14px;">ATAU</span>
      <div style="flex: 1; height: 1px; background-color: var(--divider-color);"></div>
    </div>

    <form id="email-form" style="width: 100%;">
      <input type="email" id="email" placeholder="Email" required>
      <input type="password" id="password" placeholder="Password" required>
      <button type="submit" class="btn btn-primary">Masuk / Daftar</button>
    </form>

    <p id="error-message" style="color: #ff3b30; font-size: 14px; display: none; margin-top: 10px;"></p>

    <p style="margin-top: 20px;">
      <a href="index.html" style="color: var(--accent-color); text-decoration: none;">Kembali</a>
    </p>
  </div>

  <script type="module">
    import { loginWithGoogle, loginWithEmail, registerWithEmail } from "./js/auth.js";

    const errorMsg = document.getElementById('error-message');

    // Google Login
    document.getElementById('google-login-btn').addEventListener('click', async () => {
      try {
        await loginWithGoogle();
        // Redirect handled by auth.js onAuthStateChanged
      } catch (error) {
        errorMsg.textContent = "Gagal login dengan Google.";
        errorMsg.style.display = 'block';
      }
    });

    // Email Login/Register (Simplified flow: try login, if fails, try register)
    document.getElementById('email-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      const email = document.getElementById('email').value;
      const password = document.getElementById('password').value;

      errorMsg.style.display = 'none';

      try {
        await loginWithEmail(email, password);
      } catch (loginError) {
        if (loginError.code === 'auth/user-not-found' || loginError.code === 'auth/invalid-credential') {
            // Try to register
            try {
                await registerWithEmail(email, password);
            } catch (regError) {
                if (regError.code === 'auth/email-already-in-use') {
                     errorMsg.textContent = "Password salah.";
                } else if (regError.code === 'auth/weak-password') {
                     errorMsg.textContent = "Password terlalu lemah (min 6 karakter).";
                } else {
                     errorMsg.textContent = "Gagal masuk atau daftar.";
                }
                errorMsg.style.display = 'block';
            }
        } else if (loginError.code === 'auth/wrong-password') {
             errorMsg.textContent = "Password salah.";
             errorMsg.style.display = 'block';
        } else {
            errorMsg.textContent = "Terjadi kesalahan.";
            errorMsg.style.display = 'block';
        }
      }
    });
  </script>
</body>
</html>
